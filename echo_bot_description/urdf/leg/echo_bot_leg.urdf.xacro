<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro">

  <xacro:include filename="$(find echo_bot_description)/urdf/leg/echo_bot_leg.transmission.xacro"/>
  <xacro:include filename="$(find echo_bot_description)/urdf/leg/echo_bot_leg.gazebo.xacro"/>

  <!-- == Material == -->
  <material name="leg_color_0">
    <color rgba="0.3 0.3 0.3 1"/>
  </material>

  <xacro:macro name="leg_v0" params="parent prefix *joint_origin">
    <!-- Link -->
    <link name="upper_leg_${prefix}">
      <visual>
        <origin rpy="0 0 0"/>
        <material name="leg_color_0"/>
        <geometry>
          <mesh filename="package://echo_bot_description/meshes/STL/upper_leg.stl"/>
        </geometry>
      </visual>
      <collision>
        <origin rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://echo_bot_description/meshes/DAE/upper_leg.dae"/>
        </geometry>      
      </collision>
      <inertial>
        <mass value="0.109" />
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0" />
        <inertia  ixx="0.000068" ixy="0.0" ixz="0.0" 
                  iyy="0.000086" iyz="0.0" 
                  izz="0.000136" />
      </inertial>
    </link>
    <link name="lower_leg_${prefix}">
      <visual>
        <origin rpy="0 0 0"/>
        <material name="leg_color_0"/>
        <geometry>
          <mesh filename="package://echo_bot_description/meshes/STL/lower_leg_${prefix}.stl"/>
        </geometry>
      </visual>
      <collision>
        <origin rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://echo_bot_description/meshes/DAE/lower_leg_${prefix}.dae"/>
        </geometry>      
      </collision>
      <inertial>
        <mass value="0.152994" />
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0" />
        <inertia  ixx="0.000046" ixy="-0.000012" ixz="-0.000001" 
                  iyy="0.000243" iyz="0.0" 
                  izz="0.000238" />
      </inertial>
    </link>
    <link name="upper_side_leg_${prefix}">
      <visual>
        <origin rpy="0 0 0"/>
        <material name="leg_color_0"/>
        <geometry>
          <mesh filename="package://echo_bot_description/meshes/STL/upper_side_leg.stl"/>
        </geometry>
      </visual>
      <collision>
        <origin rpy="0 0 0"/>
        <geometry>
          <mesh filename="package://echo_bot_description/meshes/DAE/upper_side_leg.dae"/>
        </geometry>      
      </collision>
      <inertial>
        <mass value="0.041157"/>
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
        <inertia  ixx="0.000003" ixy="0.0" ixz="0.0" 
                  iyy="0.000043" iyz="0.0" 
                  izz="0.000043"/>
      </inertial>
    </link>

    <!-- Joint -->
    <joint name="upper_leg_${prefix}_joint" type="revolute">
      <insert_block name="joint_origin"/>
      <parent link="${parent}" />
      <child link="upper_leg_${prefix}" />
      <axis xyz="0 1 0"/>
      <limit lower="0.0" upper="${-M_PI*30/180}" effort="30" velocity="${M_PI}"/>
    </joint>
    <xacro:leg_position_trans_v0 joint="upper_leg_${prefix}_joint"/>
    <joint name="lower_leg_${prefix}" type="revolute">
      <origin xyz="0.1 0.0 0.0" rpy="0.0 ${-M_PI*144.47/180} 0.0" />
      <parent link="upper_leg_${prefix}" />
      <child link="lower_leg_${prefix}" />
      <axis xyz="0 1 0"/>
      <limit lower="0.0" upper="${M_PI*66.73/180}" effort="30" velocity="${M_PI}"/>
      <!-- <mimic joint="upper_leg_${prefix}_joint" multiplier="-2.186" offset="-0.02025"/> -->
    </joint>
    <xacro:leg_position_trans_v0 joint="lower_leg_${prefix}"/>
    <joint name="upper_side_leg_${prefix}" type="revolute">
      <origin xyz="-0.025 0.0 0.0" rpy="0.0 ${-M_PI*54.22/180} 0.0" />
      <parent link="lower_leg_${prefix}" />
      <child link="upper_side_leg_${prefix}" />
      <axis xyz="0 1 0"/>
      <limit lower="0.0" upper="${-M_PI*64.73/180}" effort="30" velocity="${M_PI}"/>
      <!-- <mimic joint="upper_leg_${prefix}_joint" multiplier="2.123937" offset="0.003625"/> -->
    </joint>
    <xacro:leg_position_trans_v0 joint="upper_side_leg_${prefix}"/>
  </xacro:macro>

</robot>